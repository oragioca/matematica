<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Il Bruco dei Numeri - Gioco INVALSI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Chalkboard SE', cursive;
        }
        
        body {
            background: linear-gradient(to bottom, #add8e6, #87ceeb);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        
        .game-container {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 100, 0.2);
            padding: 20px;
            max-width: 900px;
            width: 100%;
            text-align: center;
            border: 5px solid #4a90e2;
            position: relative;
            max-height: 95vh;
            overflow-y: auto;
        }
        
        h1 {
            color: #000080;
            font-size: 2rem;
            margin-bottom: 5px;
            text-shadow: 2px 2px 0 #ffd700;
        }
        
        .sottotitolo {
            color: #333;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-around;
            background: #f0f8ff;
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 3px solid #4a90e2;
            position: relative;
            z-index: 10;
        }
        
        .punteggio, .vite, .livello {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .punteggio { color: #000080; }
        .vite { color: #ff0000; }
        .livello { color: #008000; }
        
        .bruco-container {
            position: relative;
            height: 150px;
            margin: 5px 0 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .segmento-bruco {
            width: 70px;
            height: 70px;
            background: linear-gradient(145deg, #32cd32, #228b22);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            margin: 0 8px;
            border: 4px solid #006400;
            box-shadow: 0 4px 8px rgba(0, 100, 0, 0.3);
            z-index: 2;
        }
        
        .linea-bruco {
            position: absolute;
            height: 12px;
            background: linear-gradient(to right, #228b22, #32cd32);
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
            border-radius: 6px;
            width: 360px;
            left: calc(50% - 180px);
        }
        
        .faccia-bruco {
            position: absolute;
            width: 50px;
            height: 50px;
            background: #228b22;
            border-radius: 50%;
            top: -25px;
            left: 120px;
            border: 3px solid #006400;
            z-index: 3;
        }
        
        .occhio {
            position: absolute;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            top: 12px;
        }
        
        .occhio-sinistro { left: 10px; }
        .occhio-destro { right: 10px; }
        
        .pupilla {
            position: absolute;
            width: 5px;
            height: 5px;
            background: black;
            border-radius: 50%;
            top: 2.5px;
            left: 2.5px;
        }
        
        .sorriso {
            position: absolute;
            width: 25px;
            height: 12px;
            border-bottom: 3px solid black;
            border-radius: 0 0 25px 25px;
            bottom: 8px;
            left: 12px;
        }
        
        .domanda {
            font-size: 1.3rem;
            color: #000080;
            margin: 15px 0;
            background: #f0f8ff;
            padding: 10px;
            border-radius: 10px;
            border: 2px dashed #4a90e2;
        }
        
        .area-risposta {
            margin: 15px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 12px;
            border: 3px solid #4a90e2;
        }
        
        .istruzione-risposta {
            font-size: 1.2rem;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .input-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }
        
        .input-risposta {
            font-size: 1.8rem;
            width: 100px;
            padding: 10px;
            text-align: center;
            border: 3px solid #4a90e2;
            border-radius: 10px;
            font-weight: bold;
            background: white;
        }
        
        .bottone-invia {
            background: linear-gradient(145deg, #32cd32, #228b22);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 1.3rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 0 #006400;
            font-weight: bold;
        }
        
        .bottone-invia:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 0 #006400;
        }
        
        .bottone-invia:active {
            transform: translateY(0);
            box-shadow: 0 2px 0 #006400;
        }
        
        .suggerimento-tasto {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .controlli-gioco {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .bottone-aiuto {
            background: linear-gradient(145deg, #ffa500, #ff8c00);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 0 #cc7000;
        }
        
        .bottone-aiuto:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 0 #cc7000;
        }
        
        .bottone-aiuto:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 0 #999999;
        }
        
        /* Stile per il pulsante Esci */
        .bottone-esci {
            background: linear-gradient(145deg, #6c757d, #5a6268);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 0 #495057;
        }
        .bottone-esci:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 0 #343a40;
        }
        .bottone-esci:active {
            transform: translateY(0);
            box-shadow: 0 2px 0 #343a40;
        }
        
        .messaggio {
            font-size: 1.2rem;
            font-weight: bold;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .corretto {
            background-color: #90ee90;
            color: #006400;
            border: 2px solid #006400;
        }
        
        .errato {
            background-color: #ffcccc;
            color: #8b0000;
            border: 2px solid #8b0000;
        }
        
        .aiuto {
            background-color: #fffacd;
            color: #b8860b;
            border: 2px dashed #b8860b;
        }
        
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .game-over-content {
            background: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            border: 5px solid #ff0000;
        }
        
        .game-over-title {
            color: #ff0000;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .game-over-punteggio {
            font-size: 1.5rem;
            color: #000080;
            margin-bottom: 15px;
        }
        
        .bottone-rigioca {
            background: linear-gradient(145deg, #32cd32, #228b22);
            border: none;
            border-radius: 12px;
            padding: 12px 25px;
            font-size: 1.3rem;
            color: white;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .istruzioni {
            background: #f0f8ff;
            padding: 10px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #333;
            border: 2px solid #4a90e2;
            line-height: 1.3;
        }
        
        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
                max-height: 98vh;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .sottotitolo {
                font-size: 1rem;
            }
            
            .segmento-bruco {
                width: 55px;
                height: 55px;
                font-size: 1.6rem;
                margin: 0 6px;
            }
            
            .linea-bruco {
                width: 280px;
                left: calc(50% - 140px);
            }
            
            .faccia-bruco {
                left: 90px;
                top: -20px;
            }
            
            .input-risposta {
                font-size: 1.5rem;
                width: 80px;
                padding: 8px;
            }
            
            .bottone-invia {
                padding: 8px 15px;
                font-size: 1.1rem;
            }
            
            .domanda {
                font-size: 1.1rem;
                padding: 8px;
            }
            
            .game-info {
                padding: 8px;
            }
            
            .punteggio, .vite, .livello {
                font-size: 1rem;
            }
            
            .controlli-gioco {
                flex-direction: column;
                align-items: center;
            }
            
            .bottone-aiuto, .bottone-esci {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üêõ IL BRUCO NUMERICO üêõ</h1>
        <p class="sottotitolo">Scopri la regola e scrivi il numero mancante!</p>
        
        <div class="game-info">
            <div class="punteggio">Punti: <span id="punteggio">0</span></div>
            <div class="vite">Vite: <span id="vite">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
            <div class="livello">Livello: <span id="livello">1</span></div>
        </div>
        
        <div class="bruco-container">
            <div class="faccia-bruco">
                <div class="occhio occhio-sinistro"><div class="pupilla"></div></div>
                <div class="occhio occhio-destro"><div class="pupilla"></div></div>
                <div class="sorriso"></div>
            </div>
            
            <div class="linea-bruco"></div>
            <div class="segmento-bruco" id="segmento0"><span>2</span></div>
            <div class="segmento-bruco" id="segmento1"><span>4</span></div>
            <div class="segmento-bruco" id="segmento2"><span>?</span></div>
            <div class="segmento-bruco" id="segmento3"><span>8</span></div>
            <div class="segmento-bruco" id="segmento4"><span>10</span></div>
        </div>
        
        <div class="domanda" id="domanda">
            Osserva i numeri. Quale numero manca?
        </div>
        
        <div class="area-risposta">
            <div class="istruzione-risposta">
                ‚úçÔ∏è SCRIVI IL NUMERO QUI SOTTO:
            </div>
            <div class="input-container">
                <input type="number" class="input-risposta" id="input-risposta" 
                       placeholder="???" min="1" max="100" autofocus>
                <button class="bottone-invia" id="bottone-invia" onclick="inviaRisposta()">
                    INVIA
                </button>
            </div>
            <div class="suggerimento-tasto">
                (Puoi anche premere INVIO sulla tastiera)
            </div>
        </div>
        
        <div class="controlli-gioco">
            <button class="bottone-aiuto" id="bottone-aiuto" onclick="mostraAiuto()">
                üß† AIUTINO (-2 punti)
            </button>
            <!-- NUOVO PULSANTE ESCI -->
            <button class="bottone-esci" onclick="esciDalGioco()">
                üö™ Esci
            </button>
        </div>
        
        <div class="messaggio" id="messaggio">
            Scrivi il numero nella casella e premi INVIA!
        </div>
        
        <div class="istruzioni">
            <strong>COME SI GIOCA:</strong><br>
            1. Osserva i numeri nel bruco<br>
            2. Scopri la regola (esempio: +2 ogni volta, numeri pari, ecc.)<br>
            3. Scrivi il numero mancante nella casella<br>
            4. Premi INVIA o il tasto INVIO<br>
            5. Hai 3 vite, se le perdi finisci il gioco. Usa AIUTINO se serve!
        </div>
    </div>
    
    <div class="game-over" id="game-over" style="display: none;">
        <div class="game-over-content">
            <h2 class="game-over-title">GAME OVER!</h2>
            <p class="game-over-punteggio">Il tuo punteggio: <span id="punteggio-finale">0</span></p>
            <p style="font-size: 1.1rem; margin-bottom: 10px;">
                Livello raggiunto: <span id="livello-finale">1</span>
            </p>
            <button class="bottone-rigioca" onclick="rigioca()">üîÑ RIGIOCA</button>
        </div>
    </div>

    <script>
        // VARIABILI DEL GIOCO
        let punteggio = 0;
        let vite = 3;
        let livello = 1;
        let aiutoUsato = false;
        let sequenzaCorrente = [];
        let rispostaCorretta = 0;
        let criterioCorrente = null;
        let tipoSequenzaCorrente = "";
        
        // ELEMENTI DOM
        const elemPunteggio = document.getElementById('punteggio');
        const elemVite = document.getElementById('vite');
        const elemLivello = document.getElementById('livello');
        const elemMessaggio = document.getElementById('messaggio');
        const inputRisposta = document.getElementById('input-risposta');
        const bottoneInvia = document.getElementById('bottone-invia');
        const bottoneAiuto = document.getElementById('bottone-aiuto');
        const gameOverScreen = document.getElementById('game-over');
        
        // CRITERI DIVERSIFICATI PER PRIMARIA - SEMPLIFICATI PER EVITARE BUG
        const criteriNumerici = {
            progressioni: [
                { nome: "+2 ogni volta", tipo: "addizione", valore: 2 },
                { nome: "+3 ogni volta", tipo: "addizione", valore: 3 },
                { nome: "+4 ogni volta", tipo: "addizione", valore: 4 },
                { nome: "+5 ogni volta", tipo: "addizione", valore: 5 },
                { nome: "-2 ogni volta", tipo: "sottrazione", valore: 2 },
                { nome: "-3 ogni volta", tipo: "sottrazione", valore: 3 }
            ],
            
            sequenzePariDispari: [
                { nome: "Numeri pari consecutivi", tipo: "pari_consecutivi" },
                { nome: "Numeri dispari consecutivi", tipo: "dispari_consecutivi" }
            ],
            
            sequenzeSpeciali: [
                { nome: "Numeri che raddoppiano", tipo: "raddoppio" },
                { nome: "Numeri che si dimezzano", tipo: "dimezzamento" },
                { nome: "Conto alla rovescia", tipo: "conto_rovescia" }
            ],
            
            tabelline: [
                { nome: "Tabellina del 2", tipo: "tabellina", valore: 2 },
                { nome: "Tabellina del 3", tipo: "tabellina", valore: 3 },
                { nome: "Tabellina del 5", tipo: "tabellina", valore: 5 },
                { nome: "Tabellina del 10", tipo: "tabellina", valore: 10 }
            ]
        };
        
        // GENERA UNA NUOVA SEQUENZA - VERSIONE CORRETTA
        function generaSequenza() {
            // Scegli categoria in base al livello
            let categorieDisponibili = [];
            
            if (livello <= 2) {
                categorieDisponibili = ['progressioni', 'sequenzePariDispari'];
            } else if (livello <= 4) {
                categorieDisponibili = ['progressioni', 'sequenzePariDispari', 'tabelline'];
            } else {
                categorieDisponibili = ['progressioni', 'sequenzePariDispari', 'tabelline', 'sequenzeSpeciali'];
            }
            
            // Scegli categoria casuale
            let categoriaScelta = categorieDisponibili[Math.floor(Math.random() * categorieDisponibili.length)];
            let listaCriteri = criteriNumerici[categoriaScelta];
            
            // Scegli criterio casuale nella categoria
            let criterioIndex = Math.floor(Math.random() * listaCriteri.length);
            criterioCorrente = listaCriteri[criterioIndex];
            tipoSequenzaCorrente = criterioCorrente.tipo;
            
            // Genera sequenza in base al tipo - VERSIONE SEMPLIFICATA E SICURA
            sequenzaCorrente = [];
            
            switch(tipoSequenzaCorrente) {
                case "addizione":
                    generaSequenzaAddizioneSicura();
                    break;
                case "sottrazione":
                    generaSequenzaSottrazioneSicura();
                    break;
                case "pari_consecutivi":
                    generaPariConsecutiviSicura();
                    break;
                case "dispari_consecutivi":
                    generaDispariConsecutiviSicura();
                    break;
                case "raddoppio":
                    generaRaddoppioSicura();
                    break;
                case "dimezzamento":
                    generaDimezzamentoSicura();
                    break;
                case "conto_rovescia":
                    generaContoRovesciaSicura();
                    break;
                case "tabellina":
                    generaTabellinaSicura();
                    break;
                default:
                    generaSequenzaAddizioneSicura();
            }
            
            // Scegli posizione del punto interrogativo (non primo, non ultimo)
            let posBuco = Math.floor(Math.random() * 3) + 1; // Posizione 1, 2 o 3
            rispostaCorretta = sequenzaCorrente[posBuco];
            
            // DEBUG: Verifica che la sequenza segua effettivamente la regola
            console.log("Sequenza generata:", sequenzaCorrente);
            console.log("Criterio:", criterioCorrente.nome);
            console.log("Risposta corretta:", rispostaCorretta);
            
            // Aggiorna il bruco
            for (let i = 0; i < 5; i++) {
                const segmento = document.getElementById(`segmento${i}`);
                if (i === posBuco) {
                    segmento.innerHTML = '<span>?</span>';
                    segmento.style.background = 'linear-gradient(145deg, #ff6b6b, #ff4757)';
                } else {
                    segmento.innerHTML = `<span>${sequenzaCorrente[i]}</span>`;
                    segmento.style.background = 'linear-gradient(145deg, #32cd32, #228b22)';
                }
            }
            
            // Reset input
            inputRisposta.value = '';
            inputRisposta.disabled = false;
            bottoneInvia.disabled = false;
            aiutoUsato = false;
            bottoneAiuto.disabled = false;
            bottoneAiuto.textContent = 'üß† AIUTINO (-2 punti)';
            
            // Focus e messaggio
            setTimeout(() => {
                inputRisposta.focus();
            }, 100);
            
            elemMessaggio.innerHTML = 'Scopri la regola e scrivi il numero mancante!';
            elemMessaggio.className = 'messaggio';
        }
        
        // FUNZIONI PER GENERARE SEQUENZE SICURE (SENZA BUG)
        
        function generaSequenzaAddizioneSicura() {
            let start = Math.floor(Math.random() * 15) + 1;
            let incremento = criterioCorrente.valore;
            for (let i = 0; i < 5; i++) {
                sequenzaCorrente.push(start + (i * incremento));
            }
            // Verifica che tutti i numeri siano positivi
            if (sequenzaCorrente[4] > 100) {
                // Se troppo grandi, rigenera con start pi√π piccolo
                sequenzaCorrente = [];
                start = Math.floor(Math.random() * 10) + 1;
                for (let i = 0; i < 5; i++) {
                    sequenzaCorrente.push(start + (i * incremento));
                }
            }
        }
        
        function generaSequenzaSottrazioneSicura() {
            let start = Math.floor(Math.random() * 10) + 40;
            let decremento = criterioCorrente.valore;
            for (let i = 0; i < 5; i++) {
                sequenzaCorrente.push(start - (i * decremento));
            }
            // Verifica che tutti i numeri siano positivi
            if (sequenzaCorrente[4] < 1) {
                // Se troppo piccoli, rigenera con start pi√π grande
                sequenzaCorrente = [];
                start = Math.floor(Math.random() * 10) + 50;
                for (let i = 0; i < 5; i++) {
                    sequenzaCorrente.push(start - (i * decremento));
                }
            }
        }
        
        function generaPariConsecutiviSicura() {
            let start = (Math.floor(Math.random() * 8) + 1) * 2; // Numero pari tra 2 e 16
            for (let i = 0; i < 5; i++) {
                sequenzaCorrente.push(start + (i * 2));
            }
        }
        
        function generaDispariConsecutiviSicura() {
            let start = (Math.floor(Math.random() * 8) * 2) + 1; // Numero dispari tra 1 e 15
            for (let i = 0; i < 5; i++) {
                sequenzaCorrente.push(start + (i * 2));
            }
        }
        
        function generaRaddoppioSicura() {
            let start = Math.floor(Math.random() * 4) + 2; // 2, 3, 4 o 5
            for (let i = 0; i < 5; i++) {
                sequenzaCorrente.push(start * Math.pow(2, i));
            }
            // Se l'ultimo numero √® troppo grande, usa start pi√π piccolo
            if (sequenzaCorrente[4] > 100) {
                sequenzaCorrente = [];
                start = Math.floor(Math.random() * 3) + 2; // 2, 3 o 4
                for (let i = 0; i < 5; i++) {
                    sequenzaCorrente.push(start * Math.pow(2, i));
                }
            }
        }
        
        function generaDimezzamentoSicura() {
            let start = Math.floor(Math.random() * 3 + 3) * 8; // 24, 32, 40
            for (let i = 0; i < 5; i++) {
                sequenzaCorrente.push(Math.floor(start / Math.pow(2, i)));
            }
        }
        
        function generaContoRovesciaSicura() {
            let start = Math.floor(Math.random() * 10) + 20; // Tra 20 e 29
            for (let i = 0; i < 5; i++) {
                sequenzaCorrente.push(start - i);
            }
        }
        
        function generaTabellinaSicura() {
            let multiplo = Math.floor(Math.random() * 5) + 1; // 1-5
            let tabellina = criterioCorrente.valore;
            for (let i = 0; i < 5; i++) {
                sequenzaCorrente.push((multiplo + i) * tabellina);
            }
        }
        
        // INVIA RISPOSTA
        function inviaRisposta() {
            const valoreInput = inputRisposta.value.trim();
            
            if (valoreInput === '') {
                elemMessaggio.innerHTML = '‚úèÔ∏è Scrivi un numero nella casella!';
                elemMessaggio.className = 'messaggio errato';
                inputRisposta.focus();
                return;
            }
            
            const valore = parseInt(valoreInput);
            if (isNaN(valore)) {
                elemMessaggio.innerHTML = 'üî¢ Devi scrivere un numero!';
                elemMessaggio.className = 'messaggio errato';
                inputRisposta.value = '';
                inputRisposta.focus();
                return;
            }
            
            if (valore < 1 || valore > 100) {
                elemMessaggio.innerHTML = 'üìè Scrivi un numero tra 1 e 100!';
                elemMessaggio.className = 'messaggio errato';
                inputRisposta.focus();
                return;
            }
            
            // Disabilita input
            inputRisposta.disabled = true;
            bottoneInvia.disabled = true;
            bottoneAiuto.disabled = true;
            
            // Verifica
            verificaRisposta(valore);
        }
        
        // VERIFICA RISPOSTA
        function verificaRisposta(risposta) {
            if (risposta === rispostaCorretta) {
                // CORRETTO
                punteggio += 10;
                elemMessaggio.innerHTML = `‚úÖ BRAVISSIMO! ${risposta} √® giusto! +10 punti`;
                elemMessaggio.className = 'messaggio corretto';
                
                elemPunteggio.textContent = punteggio;
                
                // Aumenta livello ogni 30 punti
                const nuovoLivello = Math.floor(punteggio / 30) + 1;
                if (nuovoLivello > livello) {
                    livello = nuovoLivello;
                    elemLivello.textContent = livello;
                    elemMessaggio.innerHTML += `<br>üéâ SEI PASSATO AL LIVELLO ${livello}!`;
                }
                
                // Nuova domanda
                setTimeout(() => {
                    generaSequenza();
                }, 1500);
            } else {
                // SBAGLIATO
                vite--;
                elemMessaggio.innerHTML = `‚ùå OH NO! Era ${rispostaCorretta}. -1 vita`;
                elemMessaggio.className = 'messaggio errato';
                
                // Aggiorna cuori
                let viteCuori = '';
                for (let i = 0; i < 3; i++) {
                    viteCuori += i < vite ? '‚ù§Ô∏è' : 'ü§ç';
                }
                elemVite.textContent = viteCuori;
                
                // Controlla game over
                if (vite <= 0) {
                    setTimeout(gameOver, 1500);
                } else {
                    setTimeout(() => {
                        generaSequenza();
                    }, 1500);
                }
            }
        }
        
        // MOSTRA AIUTO - ORA CORRETTO
        function mostraAiuto() {
            if (aiutoUsato) return;
            
            aiutoUsato = true;
            punteggio = Math.max(0, punteggio - 2);
            
            elemMessaggio.innerHTML = `üí° AIUTO: ${criterioCorrente.nome}`;
            elemMessaggio.className = 'messaggio aiuto';
            elemPunteggio.textContent = punteggio;
            
            bottoneAiuto.disabled = true;
            bottoneAiuto.textContent = '‚ùå AIUTINO USATO';
        }
        
        // GAME OVER
        function gameOver() {
            document.getElementById('punteggio-finale').textContent = punteggio;
            document.getElementById('livello-finale').textContent = livello;
            gameOverScreen.style.display = 'flex';
        }
        
        // RIGIOCA
        function rigioca() {
            punteggio = 0;
            vite = 3;
            livello = 1;
            
            elemPunteggio.textContent = punteggio;
            elemVite.textContent = '‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è';
            elemLivello.textContent = livello;
            elemMessaggio.innerHTML = 'Pronto per una nuova partita!';
            elemMessaggio.className = 'messaggio';
            
            gameOverScreen.style.display = 'none';
            
            generaSequenza();
        }
        
        // ==================== FUNZIONE PER ESCI ====================
        function esciDalGioco() {
            if (confirm("Vuoi davvero uscire dal gioco?")) {
                window.location.href = "https://oragioca.github.io/matematica/";
            }
        }
        
        // INIZIALIZZA
        window.onload = function() {
            generaSequenza();
        };
        
        // ENTER PER INVIARE
        inputRisposta.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                inviaRisposta();
            }
        });
    </script>
</body>

</html>

